---
import StarlightPage from '@astrojs/starlight/components/StarlightPage.astro';
import recipesData from '../../assets/recipes.json';

interface Recipe {
  id: string;
  title: string;
  category: string;
  description?: string;
  prepTime?: string | null;
  cookTime?: string | null;
  servings?: number | string | null;
  ingredients?: string | string[];
  instructions?: string | string[];
  notes?: string;
  origin?: string;
  tags?: string | string[];
  slug?: string;
  image?: string | null;
}

const recipes = recipesData.recipes as Recipe[];

function ensureArray(value: string | string[]): string[] {
  return Array.isArray(value) ? value : [value];
}

export async function getStaticPaths() {
  const data = await import('../../assets/recipes.json');
  return (data.recipes as Recipe[]).map((r) => ({ params: { id: String(r.id) } }));
}
const { params } = Astro;
const id = params.id;
const recipe = recipes.find((r) => String(r.id) === id || (r.slug && r.slug === id));
if (!recipe) {
  throw new Error('Recipe not found');
}
---

<StarlightPage frontmatter={{ title: recipe.title ?? 'Recipe', description: recipe.description ?? 'A family recipe' }}>
  <div class="recipe-detail">
    {recipe.image && <img src={recipe.image} alt={recipe.title ?? 'Recipe image'} class="recipe-image" />}
    
    <div class="recipe-header">
      <span class="recipe-category">{recipe.category}</span>
      {recipe.tags && (
        <div class="recipe-tags">
          {ensureArray(recipe.tags).map((tag) => (
            <span class="recipe-tag">{tag}</span>
          ))}
        </div>
      )}
    </div>

    {recipe.origin && <p class="recipe-origin">‚Äî {recipe.origin}</p>}

    <div class="recipe-info">
      {recipe.prepTime && <span>‚è±Ô∏è Prep: {recipe.prepTime}</span>}
      {recipe.cookTime && <span>üî• Cook: {recipe.cookTime}</span>}
      {recipe.servings && <span>üçΩÔ∏è Serves: {recipe.servings}</span>}
    </div>

    {recipe.description && <p class="recipe-description">{recipe.description}</p>}

    {recipe.ingredients && (
      <div class="recipe-section">
        <h2>Ingredients</h2>
        <ul class="ingredients-list">
          {ensureArray(recipe.ingredients).map((ingredient) => (
            <li>{ingredient}</li>
          ))}
        </ul>
      </div>
    )}

    {recipe.instructions && (
      <div class="recipe-section">
        <h2>Instructions</h2>
        <ol class="instructions-list">
          {ensureArray(recipe.instructions).map((step) => (
            <li>{step}</li>
          ))}
        </ol>
      </div>
    )}

    {recipe.notes && (
      <div class="recipe-section">
        <h2>Notes</h2>
        <p class="recipe-notes">{recipe.notes}</p>
      </div>
    )}
  </div>
</StarlightPage>

<style>
  .recipe-detail {
    max-width: 800px;
  }

  .recipe-image {
    max-width: 100%;
    height: auto;
    border-radius: 0.5rem;
    margin-bottom: 1.5rem;
  }

  .recipe-header {
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    gap: 1rem;
    margin-bottom: 1rem;
  }

  .recipe-category {
    display: inline-block;
    background: var(--sl-color-accent);
    color: white;
    padding: 0.25rem 0.75rem;
    border-radius: 1rem;
    font-size: 0.875rem;
  }

  .recipe-tags {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
  }

  .recipe-tag {
    background: var(--sl-color-gray-6);
    color: var(--sl-color-gray-2);
    padding: 0.25rem 0.5rem;
    border-radius: 0.25rem;
    font-size: 0.75rem;
  }

  .recipe-origin {
    font-style: italic;
    color: var(--sl-color-gray-3);
    margin-bottom: 1rem;
  }

  .recipe-info {
    display: flex;
    flex-wrap: wrap;
    gap: 1.5rem;
    margin-bottom: 1.5rem;
    font-size: 0.9rem;
    color: var(--sl-color-gray-2);
  }

  .recipe-description {
    font-size: 1.1rem;
    line-height: 1.6;
    margin-bottom: 2rem;
    color: var(--sl-color-gray-2);
  }

  .recipe-section {
    margin-bottom: 2rem;
  }

  .recipe-section h2 {
    font-size: 1.25rem;
    margin-bottom: 1rem;
    border-bottom: 1px solid var(--sl-color-gray-5);
    padding-bottom: 0.5rem;
  }

  .ingredients-list {
    list-style: disc;
    padding-left: 1.5rem;
  }

  .ingredients-list li {
    margin-bottom: 0.5rem;
    line-height: 1.5;
  }

  .instructions-list {
    padding-left: 1.5rem;
  }

  .instructions-list li {
    margin-bottom: 1rem;
    line-height: 1.6;
  }

  .recipe-notes {
    background: var(--sl-color-gray-6);
    padding: 1rem;
    border-radius: 0.5rem;
    font-style: italic;
    line-height: 1.6;
  }
</style>
